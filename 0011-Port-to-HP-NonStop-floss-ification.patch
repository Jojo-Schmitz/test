From ab54c51f5bdb3f7d267fd192548db792c65f588d Mon Sep 17 00:00:00 2001
From: Joachim Schmitz <jojo@schmitz-digital.de>
Date: Sun, 9 Sep 2012 08:39:09 -0500
Subject: [PATCH] Port to HP NonStop: 'floss'ification

Not supposed to go upstream, not yet at least

Signed-off-by: Joachim Schmitz <jojo@schmitz-digital.de>
---
 Makefile           | 4 ++--
 compat/poll/poll.c | 4 ++++
 git-compat-util.h  | 8 ++++++++
 3 files changed, 14 insertions(+), 2 deletions(-)

diff --git a/Makefile b/Makefile
index b1d4ef5..1943cab 100644
--- a/Makefile
+++ b/Makefile
@@ -2708,9 +2708,9 @@ install: all
 	$(INSTALL) -d -m 755 '$(DESTDIR_SQ)$(mergetools_instdir_SQ)'
 	$(INSTALL) -m 644 mergetools/* '$(DESTDIR_SQ)$(mergetools_instdir_SQ)'
 ifndef NO_GETTEXT
-	$(INSTALL) -d -m 755 '$(DESTDIR_SQ)$(localedir_SQ)'
+	-$(INSTALL) -d -m 755 '$(DESTDIR_SQ)$(localedir_SQ)'
 	(cd po/build/locale && $(TAR) cf - .) | \
-	(cd '$(DESTDIR_SQ)$(localedir_SQ)' && umask 022 && $(TAR) xof -)
+	(cd '$(DESTDIR_SQ)$(localedir_SQ)' && umask 022 && $(TAR) xvof -)
 endif
 ifndef NO_PERL
 	$(MAKE) -C perl prefix='$(prefix_SQ)' DESTDIR='$(DESTDIR_SQ)' install
diff --git a/compat/poll/poll.c b/compat/poll/poll.c
index 7d226ec..68b615c 100644
--- a/compat/poll/poll.c
+++ b/compat/poll/poll.c
@@ -63,6 +63,10 @@
 # include <sys/filio.h>
 #endif
 
+#ifdef __TANDEM /* ToDo: include git-compat-util.h instead */
+# include <floss.h(floss_select)>
+#endif
+
 #include <time.h>
 
 #ifndef INFTIM
diff --git a/git-compat-util.h b/git-compat-util.h
index 7e70361..9953100 100644
--- a/git-compat-util.h
+++ b/git-compat-util.h
@@ -252,6 +252,14 @@ extern char *gitbasename(char *);
 #define find_last_dir_sep(path) strrchr(path, '/')
 #endif
 
+#ifdef __TANDEM
+#if !defined(_THREAD_SUPPORT_FUNCTIONS) && !defined(_PUT_MODEL_)
+#include <floss.h(floss_read,floss_write,floss_fsync,floss_select,floss_fork)>
+#endif
+#include <floss.h(floss_execl,floss_execlp,floss_execv,floss_execvp)>
+#include <floss.h(floss_getpwuid)>
+#endif
+
 #if defined(__HP_cc) && (__HP_cc >= 61000)
 #define NORETURN __attribute__((noreturn))
 #define NORETURN_PTR
-- 
1.7.12

